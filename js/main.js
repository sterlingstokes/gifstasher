"use strict";var Utility=function(){function t(e,t,n){if(e.attachEvent){return e.attachEvent("on"+t,n)}else{return e.addEventListener(t,n,false)}}var e={start:function(e,t,n){this.end();var r=$("#flash-template").clone();r.addClass("flash").attr("id","");if(n){r.addClass("alert-"+n)}r.find(".flash-message").text(e);r.find(".flash-title").text(t);r.appendTo("#flash-holder");r.fadeIn("fast").delay(5e3).fadeOut("fast")},end:function(){$(".flash").stop().remove()}};return{addEvent:t,flash:e}}();var Menu=function(){function a(e){var t=document.createElement("li");t.className="gif";t.dataset.id=e.id;var n=document.createElement("div");var r=document.createElement("div");r.className="overlay";var o=document.createElement("button");o.setAttribute("type","button");o.className="btn btn-info";var u=document.createTextNode("View Gif");o.appendChild(u);var a=document.createElement("button");a.setAttribute("type","button");a.className="btn btn-success copy-btn";var l=document.createTextNode("Copy Link");a.appendChild(l);var c=document.createElement("button");c.setAttribute("type","button");c.setAttribute("data-toggle","modal");c.setAttribute("data-target","#removeModal");c.className="btn btn-danger";var h=document.createTextNode("Unstash Gif");c.appendChild(h);var p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("value",e.url);r.appendChild(p);r.appendChild(o);r.appendChild(a);r.appendChild(c);var d=document.createElement("img");d.src=e.url;t.appendChild(n);t.appendChild(d);t.appendChild(r);i.appendChild(t);Utility.addEvent(c,"click",function(t){f(e.id);s.start("Your gif has been removed.","BOOM!","danger");t.stopPropagation()});var v=document.createElement("img");v.src=e.url;var m=$("#gallery");var g=m.find(".modal-content");Utility.addEvent(o,"click",function(e){g.html("");g.append(v);m.modal("show");e.stopPropagation()});Utility.addEvent(v,"click",function(e){m.modal("hide");$(v).remove();e.stopPropagation()});Utility.addEvent(a,"click",function(){p.select();p.focus();document.execCommand("SelectAll");document.execCommand("Copy",false,null);s.start("The link has been copied to your clipboard. Paste away!","Yay!","success")})}function f(e,t){$('li[data-id="'+e+'"]').remove();$.each(n,function(t){if(n[t].id===e){n.splice(t,1);return false}});if(n.length===0){$("#no-gifs").show()}r=JSON.stringify(n);localStorage.setItem("gifs",r)}function l(){localStorage.removeItem("gifs");n=[];var e=i.getElementsByTagName("li");for(var t=0,r=e.length;t<r;t++){e[t].onclick=null}while(i.firstChild){i.removeChild(i.firstChild)}}function c(e){var t=document.getElementById("menu-form").elements;var i=t.url.value;var o=i.substring(i.lastIndexOf("/")+1);var u=o.split(".").pop();if(t.url.value.length!==0&&(u==="gif"||u==="jpg")){$("#no-gifs").hide();var f={id:Date.now(),title:"",url:t.url.value,tags:[],isFavorite:false};n.unshift(f);r=JSON.stringify(n);localStorage.setItem("gifs",r);a(f);t.url.value="";t.url.focus();$("#menu-form-modal").modal("hide");s.start("Your gif has been stashed!","Woohoo!","success");e.preventDefault()}else{if(u!=="gif"||u!=="jpg"){$("#menu-form-modal").modal("hide");s.start("There was a problem! Are you sure that it's a gif link?","Oh noes!","danger")}e.preventDefault();return false}}function h(){if(n.length===0){$("#no-gifs").show()}else{$("#no-gifs").hide();for(var e=0,r=n.length;e<r;e++){a(n[e])}}$(o).bind("click",function(e){e.stopPropagation()});$(".cancel-btn").bind("click",function(){$(".modal").modal("hide")});Utility.addEvent(o,"submit",c);Utility.addEvent(t,"click",l)}var e=chrome.extension.getBackgroundPage(),t=document.getElementById("clearGifs"),n=[],r,i=document.getElementById("menu"),s=Utility.flash,o=document.getElementById("menu-form"),u=document.getElementById("options-btn");if(localStorage.getItem("gifs")){n=JSON.parse(localStorage.getItem("gifs"))}Utility.addEvent(u,"click",function(e){chrome.tabs.create({url:"options.html"});e.stopPropagation()});$("#menu-form-modal").on("show.bs.modal",function(e){setTimeout(function(){$("#gif-url").focus()},500)});return{appendGif:a,createGif:c,init:h}}();window.onload=Menu.init()